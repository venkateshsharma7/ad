<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard | AnnaDaatha</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-50">

  {% include "navbar.html" %}

  <div class="max-w-5xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <h2 class="text-2xl font-bold mb-6 text-green-700">Admin Dashboard</h2>

    <!-- Pending Users Section -->
    <section class="mb-12">
      <h3 class="text-lg font-bold mb-4">Pending Users:</h3>
      {% if users %}
        <div class="space-y-4">
          {% for user in users %}
            <div class="p-4 bg-white rounded border flex flex-col sm:flex-row sm:items-center sm:justify-between">
              <div>
                <strong>{{ user.name | e }}</strong>
                (<a href="mailto:{{ user.email | e }}" class="text-blue-600 underline">{{ user.email | e }}</a>)
                - {{ user.role | capitalize | e }}
                <span class="ml-2 text-gray-500">Status: {{ user.status | capitalize }}</span>
              </div>
              <div class="mt-3 sm:mt-0 flex flex-wrap gap-2">
                <form action="{{ url_for('approve_user', user_id=user._id) }}" method="post" class="inline">
                  <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 focus:outline-none focus:ring focus:ring-green-400">Approve</button>
                </form>
                <form action="{{ url_for('reject_user', user_id=user._id) }}" method="post" class="inline">
                  <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 focus:outline-none focus:ring focus:ring-red-400">Reject</button>
                </form>
                {% if user.kyc_file %}
                  <a href="{{ url_for('static', filename='uploads/' + user.kyc_file) }}" target="_blank" rel="noopener" class="underline text-sm text-blue-700 ml-2">View KYC</a>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-500">No pending users.</p>
      {% endif %}
    </section>

    <!-- Pending/Requested Food Donations Section -->
    <section>
      <h3 class="text-lg font-bold mb-4">Pending Food Donations:</h3>
      {% if foods %}
        <div class="space-y-4">
          {% for food in foods %}
            <div class="p-4 bg-white rounded border flex flex-col sm:flex-row sm:items-center sm:justify-between">
              <div>
                <strong>{{ food.food_name | e }}</strong>
                <span class="ml-2 text-xs rounded px-2 py-1 
                  {% if food.status == 'pending' %}bg-yellow-200 text-yellow-900
                  {% elif food.status == 'approved' %}bg-green-200 text-green-900
                  {% elif food.status == 'requested' %}bg-blue-200 text-blue-900
                  {% elif food.status == 'delivered' %}bg-green-600 text-white
                  {% else %}bg-gray-200 text-gray-800{% endif %}"
                >{{ food.status|capitalize }}</span>
                â€“ {{ food.description | e }}<br />
                <span class="font-semibold">Quantity:</span> {{ food.quantity }} &nbsp;|&nbsp;
                <span class="font-semibold">Expires:</span> {{ food.expiry_time.strftime('%Y-%m-%d %H:%M') }}
              </div>
              <div class="mt-3 sm:mt-0 flex flex-wrap gap-2 items-center">
                {% if food.status == 'pending' %}
                  <form action="{{ url_for('approve_food', food_id=food._id) }}" method="post" class="inline">
                    <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 focus:outline-none focus:ring focus:ring-green-400">Approve</button>
                  </form>
                  <form action="{{ url_for('reject_food', food_id=food._id) }}" method="post" class="inline">
                    <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 focus:outline-none focus:ring focus:ring-red-400">Reject</button>
                  </form>
                {% elif food.status == 'requested' %}
                  <form action="{{ url_for('mark_delivered', food_id=food._id) }}" method="post" class="inline">
                    <button class="bg-blue-600 text-white px-3 py-1 rounded hover:bg-blue-700 ml-2" type="submit">Mark Delivered</button>
                  </form>
                  <form action="{{ url_for('reject_food', food_id=food._id) }}" method="post" class="inline">
                    <button type="submit" class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 focus:outline-none focus:ring focus:ring-red-400">Reject</button>
                  </form>
                {% endif %}
                {% if food.photo %}
                  <a href="{{ url_for('static', filename='uploads/' + food.photo) }}" target="_blank" rel="noopener" class="underline text-sm text-blue-700 ml-2">View Photo</a>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-500">No pending food donations.</p>
      {% endif %}
    </section>

    <a href="/dashboard" class="block mt-8 text-sm text-green-700 hover:underline text-center">Back to Personal Dashboard</a>
  </div>
</body>
</html>
